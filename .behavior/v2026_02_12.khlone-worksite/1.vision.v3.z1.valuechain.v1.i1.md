# khlone: value chain

> progressive releases from minimum viable to full vision

---

## value kernel inventory

| kernel | description | user value |
|--------|-------------|------------|
| **replbuffer** | buffer layer between human and repl â€” instant input, queue, crash recovery, headless | 0ms keystrokes, stable clones |
| **shell-native** | ask/act-and-return ux with --who (clone or role++), --when, envvar, implicit init | shell stays yours |
| **zone-provision** | findsert zone via declastruct-aws (instance + supplies + worktree) | ready to work |
| **git-patch-sync** | sync code between local and remote via patches | foundation for all remote work |
| **remote-shell** | execute commands on remote machine | run tests/builds off laptop |
| **clone-spawn** | spawn a clone (brain + role) on remote | offload ai compute |
| **ask/act** | send questions or tasks to clones | direct work to clones |
| **attach-detach** | drop into clone's raw stream | observe and interact |
| **transcript** | archive clone output | review what happened, token account |
| **conflict-resolution** | detect and resolve divergent edits | safe concurrent work |
| **crew-management** | add/remove clones dynamically | scale up/down as needed |
| **clone-coordination** | clone.0 hires and manages crew | autonomous coordination |
| **multi-zone** | parallel zones on separate features | parallel feature dev |
| **offline-queue** | queue changes when disconnected | work anywhere |
| **orchestrator** | manage zone lifecycle | up/down/ttl/cost |
| **tui** | local interface with filtered output | clean ux, low resource |
| **cost-tracker** | track tokens per clone | know where money went |
| **secrets-injection** | inject secrets into remote | real work with apis |

---

## dependency graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    v0.0: LOCAL FOUNDATION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  replbuffer  â”‚ â”€â”€â–º â”‚ shell-native  â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚   (instant input,      (ask/act+return,                        â”‚
â”‚    queue, crash         implicit init,                         â”‚
â”‚    recovery, headless)  worksite bind)                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    v0.1+: REMOTE ZONES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚  zone-provision    â”‚ â—„â”€â”€ declastruct-aws                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚            â”‚                                                    â”‚
â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚            â”‚                                â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  git-patch-sync  â”‚              â”‚  remote-shell   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚            â”‚                                â”‚                  â”‚
â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â”‚                â”‚                                  â”‚
â”‚            â–¼                â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ conflict-res â”‚   â”‚  clone-spawn  â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                             â”‚                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚                 â”‚                        â”‚
â”‚                    â–¼                 â–¼                        â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚             â”‚ ask/act  â”‚     â”‚ attach-detach â”‚                â”‚
â”‚             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                  â”‚                                            â”‚
â”‚                  â–¼                                            â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚             â”‚ transcript â”‚                                    â”‚
â”‚             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                   â”‚                                           â”‚
â”‚                   â–¼                                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚          â”‚ crew-management â”‚                                  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                  â”‚                                            â”‚
â”‚                  â–¼                                            â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚          â”‚ clone-coordinationâ”‚                                â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                  â”‚                                            â”‚
â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                  â”‚                  â”‚                        â”‚
â”‚                  â–¼                  â–¼                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚          â”‚   multi-zone   â”‚  â”‚ offline-queue â”‚               â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                  â”‚                                           â”‚
â”‚                  â–¼                                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚          â”‚ orchestrator â”‚                                    â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                  â”‚                                           â”‚
â”‚                  â–¼                                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚          â”‚     tui      â”‚                                    â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## value chain: progressive releases

### v0.0: replbuffer + shell-native ğŸ¯ **anchor**

> buffer local repls, ask or act then return to shell

**what ships:**
- `khlone ask "..."` â€” queue question, return to shell
- `khlone act "..."` â€” queue action, return to shell
- `khlone ask "..." --when disrupt` â€” interrupt for immediate answer
- `khlone act "..." --who reviewer.1` â€” target specific clone
- `khlone ask "..." --watch` â€” queue, then stream output (= ask && watch)
- `khlone status` â€” snapshot of zone + clone status
- `khlone watch` â€” live progress (ctrl+c to exit)
- `khlone attach` â€” drop into interactive mode
- `khlone log` â€” view transcript
- `$KHLONE_SESSION` envvar for automatic session resume

**user value:**
- instant input (0ms keystrokes â€” no more lag from brain repl ui)
- shell stays yours (ask/act and return)
- zone awareness (always know where; zone set at init, auto-resolved from cwd)
- clone target (--who)
- enqueue vs disrupt (--when)
- crash recovery (queue persists, auto-restart)
- session resume (envvar preserves context)
- low resource (headless by default)
- token account (transcript archived)

**fleshes out:**
- replbuffer layer (queue, headless, crash recovery)
- shell-native ux (ask/act, --who, --when, envvar)
- transcript capture
- basic tui (status, watch, attach)

**why anchor:**
- no infrastructure needed â€” works with local repls today
- immediate pain relief â€” stable clones, low resource, crash recovery
- foundation for all else â€” same ux extends to remote zones
- minimum surface â€” wraps claude-code, opencode, etc. as-is
- proves the core â€” if local ask/act works, remote is just a transport

**example flow:**
```sh
# act on a task, get your shell back
$ khlone act "implement jwt validation"
âœ“ enqueued to mechanic.1 (zone: ~/code/myproject)
$ _                              # shell is yours

# session auto-resumes in same shell
$ echo $KHLONE_SESSION
abc123
$ khlone act "add tests"         # resumes same session
âœ“ enqueued to mechanic.1 (zone: ~/code/myproject)

# ask a question
$ khlone ask "what files changed?"
âœ“ enqueued to mechanic.1 (zone: ~/code/myproject)

# ask with disrupt for immediate answer
$ khlone ask "status?" --when disrupt
âœ“ sent to mechanic.1 [disrupt]
mechanic.1: active (67%) â€” implement jwt validation

# check status anytime
$ khlone status
zone: ~/code/myproject (local)
mechanic.1: active (67%) â€” implement jwt validation

# watch live progress
$ khlone watch
[~/code/myproject] mechanic.1: implement jwt validation (67%)
^C                               # ctrl+c returns to shell
$ _

# drop into interactive mode when needed
$ khlone attach mechanic.1
[attached â€” mechanic.1 @ ~/code/myproject]
> what files did you change?
[clone responds...]
> /exit
$ _                              # back to shell
```

**architecture:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       replbuffer                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  queue persistence â”‚ headless execution â”‚ crash recovery   â”‚
â”‚  transcript captureâ”‚ auto-restart       â”‚ token tracker    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      shell-native                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ask/act + return  â”‚ --who clone       â”‚ --when enqueue    â”‚
â”‚  zone awareness    â”‚ session envvar    â”‚ attach opt-in     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### v0.1: zone bootstrap + remote test runner

> provision machine, init worktree, run tests remotely

**what ships:**
- `khlone zone set` â€” findsert zone (instance + supplies + worktree)
- `khlone zone del` â€” delete zone (with safety checks)
- `khlone sync` â€” push local changes to remote via git patch
- `khlone shell` â€” execute command on remote (e.g., `npm run test`)
- `khlone pull` â€” pull results back

**depends on:** v0.0 (shell-native ask/act ux)

**user value:**
- laptop cpu/ram freed while tests run
- no thermal throttle on heavy test suites
- faster feedback (remote has more cores)

**fleshes out:**
- zone config (khlone.worksite.yml)
- zone provision via declastruct-aws (instance + supplies + worktree)
- git patch sync mechanism
- basic connection handler

**why this order:**
- v0.0 proves the ux â€” ask/act, attach, watch work locally
- v0.1 adds remote execution â€” same ux, different transport
- zone bootstrap is infra-heavy â€” defer until ux is proven

**example flow:**
```sh
# first time: bootstrap zone (persists zone config for this worktree)
khlone init                        # findsert ec2, clone repo, install deps
zone: ~/code/myproject (remote: us-east-1)
âœ“ ready

# you write code locally
vim src/auth.ts

# push to remote, run tests there (zone auto-resolved from cwd)
khlone sync
khlone shell "npm run test"

# pull any generated files back
khlone pull

# done for the day
khlone halt                        # pause instance (or khlone drop to delete)
```

**provision detail:**
```
khlone init
    â”‚
    â”œâ”€â”€ read khlone.worksite.yml (per repo, at gitroot)
    â”‚   â”œâ”€â”€ zone: local | remote, instance config, constraints (ttl, cost)
    â”‚   â””â”€â”€ crew: clone.0, defaults, limits
    â”‚
    â”œâ”€â”€ create zone for this worktree (instance of repo config)
    â”‚
    â””â”€â”€ if remote:
        â””â”€â”€ zone.provision via declastruct-aws
            â”œâ”€â”€ provision instance (findsert ec2)
            â”œâ”€â”€ provision supplies (node, pnpm)
            â””â”€â”€ provision worktree (git clone, checkout, npm ci)
```

---

### v0.2: single clone

> spawn one clone on remote to do work

**what ships:**
- `khlone zone set` â€” findsert zone (if not already up)
- `khlone crew add --role mechanic --brain claude` â€” start a clone
- `khlone crew attach clone.N` â€” stream clone output
- `khlone zone del` â€” terminate

**depends on:** v0.1 (sync)

**user value:**
- offload ai compute to remote
- laptop stays cool
- watch clone work in real-time

**fleshes out:**
- clone spawn mechanism
- attach/detach stream
- daemon basics

---

### v0.3: remote ask/act + transcript

> send tasks to remote clone, archive what happened

**what ships:**
- `khlone ask "..."` â€” ask clone (zone auto-resolved from cwd)
- `khlone act "..."` â€” act on clone (zone auto-resolved from cwd)
- `khlone log` â€” view transcript
- `khlone log --export` â€” export to markdown

**depends on:** v0.2 (clone)

**user value:**
- fire-and-forget tasks
- review what clone did
- token account

**fleshes out:**
- remote ask/act mechanism
- transcript storage
- cost tracker

---

### v0.4: conflict resolution

> detect and resolve divergent edits

**what ships:**
- `khlone pull` detects conflicts
- `khlone diff` shows conflict
- `khlone resolve --keep local|remote|--merge`

**depends on:** v0.1 (sync)

**user value:**
- safe to edit locally while clone edits remotely
- explicit resolution, no surprises
- no lost work

**fleshes out:**
- conflict detection
- resolution ux
- merge tools

---

### v0.5: crew management

> multiple clones with different roles

**what ships:**
- `khlone crew get` â€” list clones
- `khlone crew add --role X --brain Y` â€” add clone
- `khlone crew del clone.N` â€” remove clone
- auto-number: mechanic.1, mechanic.2, ...

**depends on:** v0.2 (clone)

**user value:**
- parallel work on same codebase
- specialized roles (architect, mechanic, tester)
- scale up/down as needed

**fleshes out:**
- crew registry
- role.N numbers
- multi-clone router

---

### v0.6: clone.0 coordination

> clone.0 can hire and manage crew autonomously

**what ships:**
- `khlone.worksite.yml` â€” configure clone.0
- clone.0 can `crew add` / `act` to other clones
- human can override via `--who clone.N`

**depends on:** v0.5 (crew)

**user value:**
- act once, clone.0 coordinates
- autonomous team scale
- human oversight when needed

**fleshes out:**
- foreman role
- autonomous coordination
- override semantics

---

### v0.7: zone registry + orchestrator

> track all zones, manage lifecycle

**what ships:**
- `khlone zone list` â€” list all zones across worktrees
- `khlone zone halt --all` â€” pause all remote zones
- orchestrator basics (ttl, cost alerts)

**depends on:** v0.6 (coordination)

**user value:**
- see all active zones at a glance
- manage zone lifecycle centrally
- cost awareness

**fleshes out:**
- zone registry
- orchestrator basics

**note:** multi-zone is definitional â€” each worktree has its own `khlone.worksite.yml` and thus its own zone. this milestone just adds tooling to manage them collectively.

---

### v0.8: offline resilience

> queue changes when disconnected

**what ships:**
- `khlone status` shows queued changes
- `khlone reconnect` syncs queue
- auto-retry on connection restore

**depends on:** v0.1 (sync)

**user value:**
- work on train, plane, coffee shop
- no lost work on disconnect
- seamless resume

**fleshes out:**
- offline queue
- reconnect logic
- sync state tracker

---

### v0.9: full tui

> local interface with crew view, zone status

**what ships:**
- `khlone` (no args) â€” launch tui
- crew panel, zone panel, log panel
- filtered output by default
- keyboard shortcuts

**depends on:** v0.7 (multi-zone)

**user value:**
- clean overview of all work
- low resource consumption
- instant keystrokes

**fleshes out:**
- tui framework
- output filter
- panel layout

---

### v1.0: full khlone

> complete vision

**what ships:**
- all above + polish
- orchestrator (local + cloud mode)
- secrets injection
- cost alerts
- ttl auto-shutdown

**user value:**
- production-ready system
- cross-device access (cloud mode)
- full pit of success

---

## alternative anchors considered

| anchor candidate | leverage | yield | risk |
|------------------|----------|-------|------|
| **replbuffer + shell-native** âœ… | highest (ux foundation) | highest (immediate stability) | lowest (no infra) |
| zone bootstrap + test runner | high (infra + sync is foundation) | high (immediate pain relief) | low (declastruct-aws + git patterns) |
| sync only (assume instance exists) | medium (skips infra complexity) | medium (manual setup burden) | low (simpler scope) |
| single clone first | medium (needs infra + sync anyway) | medium (ai offload) | medium (daemon complexity) |
| tui first | low (needs backend) | low (pretty but no function) | high (wasted work) |
| full crew first | low (too much at once) | high (if it works) | high (too many unknowns) |

**winner: replbuffer + shell-native**

- no infrastructure needed â€” works with local repls today (claude-code, opencode, etc.)
- immediate pain relief â€” stable clones, crash recovery, low resource consumption
- ux is the hard part â€” prove ask/act/attach/watch before complex infra
- same ux extends to remote â€” v0.1 just adds a transport layer
- clear upgrade path â€” local first, then remote zones layer on top

---

## chain summary

```
v0.0: replbuffer + shell-native  â† ANCHOR (ask/act + attach + watch + transcript)
  â”‚
  â”‚   LOCAL FOUNDATION
  â”‚   - buffer local repls (crash recovery, queue, headless)
  â”‚   - shell-native ux (ask/act, --who, --when, envvar)
  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”‚
v0.1: zone bootstrap + test runner  (provision + sync + shell)
  â”‚
  â”œâ”€â”€ v0.4: conflict resolution (parallel track)
  â”‚
v0.2: single clone           (spawn remote clone)
  â”‚
v0.3: remote ask/act + transcript  (remote tasks + logs)
  â”‚
v0.5: crew management        (multiple clones)
  â”‚
v0.6: clone.0 coordination   (autonomous foreman)
  â”‚
  â”œâ”€â”€ v0.8: offline resilience (parallel track)
  â”‚
v0.7: zone registry      (list zones, manage lifecycle)
  â”‚
v0.9: full tui               (clean interface)
  â”‚
v1.0: full khlone            (production ready)
```

each link adds one layer of value. each can ship independently. each proves the foundation for the next.

---

## v0.0 dependency stack

```
replbuffer        â† instant input (0ms), queue, crash recovery, headless, transcript
       â”‚
       â–¼
shell-native      â† ask/act, --who, --when, envvar, attach
```

v0.0 ships the local foundation â€” same ux for local and remote. instant input is the killer feature: brain repls lag, replbuffer doesn't.

---

## v0.1 dependency stack

```
v0.0 (shell-native ux)
       â”‚
       â–¼
khlone.worksite.yml        â† per repo config (zone, crew, constraints)
       â”‚
       â–¼
khlone init                â† create zone for worktree (instance of config)
       â”‚
       â–¼
zone-provision    â† declastruct-aws (instance + supplies + worktree)
       â”‚
       â–¼
git-patch-sync    â† khlone sync / khlone pull
       â”‚
       â–¼
remote-shell      â† khlone shell "npm run test"
```

v0.1 adds the remote transport â€” same ux, now with zone infrastructure.
