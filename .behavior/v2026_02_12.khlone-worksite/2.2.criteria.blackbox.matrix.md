# khlone v0.0: blackbox coverage matrix

> dimension analysis of blackbox criteria

---

## matrix.1 = dispatch behavior

covers: usecase.1 (instant dispatch), usecase.2 (queue stack)

| ind: init state | ind: verb | ind: queue mode | dep: shell | dep: zone | dep: clone | dep: queue position |
|-----------------|-----------|-----------------|------------|-----------|------------|---------------------|
| initialized | ask | enqueue (default) | returns immediately | current | hero | end of queue |
| initialized | act | enqueue (default) | returns immediately | current | hero | end of queue |
| initialized | ask | --prioritize | returns immediately | current | hero | front of queue |
| initialized | act | --prioritize | returns immediately | current | hero | front of queue |
| initialized | ask | --when disrupt | returns immediately | current | hero | interrupts current |
| initialized | act | --when disrupt | returns immediately | current | hero | interrupts current |
| not initialized | ask | enqueue | returns immediately | auto-init | hero enrolled | first task |
| not initialized | act | enqueue | returns immediately | auto-init | hero enrolled | first task |

**gaps:** none — all combinations covered

---

## matrix.2 = observation modes

covers: usecase.3 (observation modes), usecase.4 (block output)

| ind: mode | ind: invocation | dep: shell behavior | dep: clone continues | dep: queue |
|-----------|-----------------|---------------------|----------------------|------------|
| watch | `khlone watch` | streams, ctrl+c exits | yes | unchanged |
| watch | `--watch` flag | queues then streams | yes | unchanged |
| talk | `khlone talk` | interactive session | yes | paused |
| talk | `--talk` flag | queues then interactive | yes | paused |
| await | `--await` flag | blocks until complete | n/a (task done) | unchanged |

**gaps:** none — all combinations covered

**note:** `--watch` and `--talk` are mutually exclusive (error experience documented)

---

## matrix.3 = status scope resolution

covers: usecase.5 (status inspection)

| ind: pwd context | ind: explicit scope | dep: scope shown |
|------------------|---------------------|------------------|
| feature branch | (none) | zone |
| main branch | (none) | site |
| not a git repo | (none) | orchestrator |
| any | `orchestrator` | orchestrator |
| any | `site` | site |
| any | `zone` | zone |
| any | `--task task-id` | task details |
| any | `--who clone-id` | clone details |

**gaps:** none — smart defaults + explicit override both covered

---

## matrix.4 = resource enumeration

covers: usecase.6 (resource enumeration)

| ind: scope | dep: shows | dep: includes |
|------------|------------|---------------|
| sites | all sites on machine | zone counts, activity |
| zones | all zones in current site | clone status per zone |
| crews | all clones in current zone | role, brain, status, queue depth |
| tasks | all tasks in current zone | status, clone, tokens |

**gaps:** none — all four scopes covered

---

## matrix.5 = clone target resolution

covers: usecase.7 (clone target)

| ind: --who value | ind: role valid | dep: target | dep: enroll |
|------------------|-----------------|-------------|------------|
| (none) | n/a | hero | no |
| `clone.n` | n/a | specified clone | no |
| `role++` | yes | new clone | yes |
| `role++` | no | error | no |

**gaps:** none — default, extant, enroll, and error cases covered

---

## matrix.6 = skill dispatch route

covers: usecase.8 (skill dispatch)

| ind: skill location | dep: target | dep: enroll | dep: outcome |
|---------------------|-------------|------------|--------------|
| hero knows | hero | no | skill invoked |
| single role knows | that role | yes (if needed) | skill invoked |
| multiple roles know | n/a | no | error: ambiguity |
| no role knows | n/a | no | error: not found |

**gaps:** none — all route cases covered

---

## matrix.7 = brain selection

covers: usecase.9 (brain selection)

| ind: --brain value | ind: brain valid | dep: brain used | dep: hero default affected |
|--------------------|------------------|-----------------|----------------------------|
| (none) | n/a | hero default (claude) | n/a |
| alias | yes | specified brain | no |
| alias | no | error | n/a |

**gaps:** none — default, override, and error cases covered

---

## matrix.8 = cross-scope dispatch

covers: usecase.10 (cross-zone), usecase.11 (cross-site)

| ind: scope level | ind: target extant | dep: outcome | dep: user location |
|------------------|-------------------|--------------|-------------------|
| zone (same site) | yes | dispatch to zone | unchanged |
| zone (same site) | no | create zone, dispatch | unchanged |
| site (different repo) | yes | dispatch to site | unchanged |
| site (different repo) | no | error: not found | unchanged |

**gaps:** none — existence checks covered for both scopes

---

## matrix.9 = crash recovery

covers: usecase.12 (crash recovery)

| ind: failure mode | dep: clone | dep: task | dep: user impact |
|-------------------|------------|-----------|------------------|
| clone crashes | auto-restart | resume from checkpoint | none |
| shell exits | continues | queue preserved | none |
| shell reopens | (was active) | status shows progress | none |

**gaps:** none — crash and shell exit both covered

---

## matrix.10 = artifacts and logs

covers: usecase.13 (task artifacts), usecase.14 (transcript access)

| ind: query type | ind: scope | dep: shows |
|-----------------|------------|------------|
| status | --task id | artifacts (summary, complete, tokens) |
| log | (none) | current clone transcript |
| log | --who clone | specified clone transcript |

**gaps:** none — artifact query and log query both covered

---

## matrix.11 = error conditions

covers: error experiences

| ind: condition | dep: error message | dep: suggestion |
|----------------|-------------------|-----------------|
| not in git repo | not in a git repo | use --site flag |
| khlone.yml absent | absent config | how to create khlone.yml |
| --watch + --talk | mutually exclusive flags | (none needed) |
| invalid zone format | invalid format | valid formats |
| unknown role++ | unknown role | list available roles |
| unknown --brain | unknown brain | list available brains |
| unknown --skill | skill not found | list available skills |
| ambiguous --skill | ambiguity | list roles, suggest --who |
| unknown --site | site not found | how to register site |

**gaps:** none — all documented error cases covered

---

## decomposition analysis

all matrices have 2-3 independent dimensions — no decomposition needed.

the behavioral boundaries are appropriately scoped:
- dispatch behavior (init × verb × queue mode)
- observation modes (mode × invocation)
- status scope (pwd × explicit)
- clone target (--who × validity)
- skill dispatch (location)
- brain selection (--brain × validity)
- cross-scope (level × existence)
- crash recovery (failure mode)
- artifacts/logs (query × scope)
- errors (condition)

each matrix is small enough to enumerate fully.

---

## coverage summary

| matrix | combinations | gaps |
|--------|--------------|------|
| dispatch behavior | 8 | 0 |
| observation modes | 5 | 0 |
| status scope | 8 | 0 |
| resource enumeration | 4 | 0 |
| clone target | 4 | 0 |
| skill dispatch | 4 | 0 |
| brain selection | 3 | 0 |
| cross-scope dispatch | 4 | 0 |
| crash recovery | 3 | 0 |
| artifacts and logs | 3 | 0 |
| error conditions | 9 | 0 |

**total: 55 combinations, 0 gaps**
