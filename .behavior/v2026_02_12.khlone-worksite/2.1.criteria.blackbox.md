# khlone v0.0: blackbox criteria

> experience boundaries for site orchestration

---

## usecase.1 = instant dispatch

```
given(user in a git worktree with khlone.yml)
  when(user runs `khlone act "implement auth"`)
    then(shell returns immediately)
      sothat(user can continue other work)
    then(output shows task queued to hero clone)
    then(output shows zone context)

  when(user runs `khlone ask "what changed?"`)
    then(shell returns immediately)
    then(output shows task queued to hero clone)

given(user in a git worktree without prior init)
  when(user runs `khlone act "first task"`)
    then(zone is auto-initialized)
    then(hero clone is enrolled)
    then(task is queued)
    then(shell returns immediately)
      sothat(explicit init is never required)
```

## usecase.2 = queue stack

```
given(hero clone is active on a task)
  when(user runs `khlone act "second task"`)
    then(task is added to queue)
    then(shell returns immediately)
    then(output shows task queued)
      sothat(user can stack multiple tasks without wait)

  when(user runs `khlone act "urgent fix" --prioritize`)
    then(task is added to front of queue)
    then(output indicates priority position)

  when(user runs `khlone ask "interrupt me" --when disrupt`)
    then(current task is paused)
    then(new task runs immediately)
```

## usecase.3 = observation modes

```
given(clone is active)
  when(user runs `khlone watch`)
    then(output streams clone progress)
    then(ctrl+c returns to shell)
    then(clone continues work)
      sothat(observation is passive)

  when(user runs `khlone act "task" --watch`)
    then(task is queued)
    then(output streams clone progress)
    then(ctrl+c returns to shell)

given(clone is active)
  when(user runs `khlone talk`)
    then(user enters interactive session with clone)
    then(/exit returns to shell)
    then(queue pauses while in talk mode)
      sothat(conversation is focused)

  when(user runs `khlone ask "question" --talk`)
    then(task is queued)
    then(user enters interactive session)
```

## usecase.4 = block output

```
given(user wants output piped to file)
  when(user runs `khlone ask "summarize" --await >> summary.md`)
    then(shell blocks until task completes)
    then(output emits to stdout)
    then(output is captured in file)
      sothat(shell-native pipelines work)

  when(user runs `khlone act "generate report" --await`)
    then(shell blocks until task completes)
    then(final output emits to stdout)
```

## usecase.5 = status inspection

```
given(user in a feature branch worktree)
  when(user runs `khlone status`)
    then(output shows zone-level status)
    then(output shows active clones and progress)
    then(output shows queued tasks)
      sothat(smart defaults match context)

given(user in main branch worktree)
  when(user runs `khlone status`)
    then(output shows site-level status)
    then(output shows all zones in repo)

given(user outside any git repo)
  when(user runs `khlone status`)
    then(output shows orchestrator-level status)
    then(output shows all sites on machine)

given(user wants explicit scope)
  when(user runs `khlone status orchestrator`)
    then(output shows orchestrator-level status)

  when(user runs `khlone status --task task-abc-123`)
    then(output shows task details and artifacts)

  when(user runs `khlone status --who mechanic.1`)
    then(output shows clone details and queue)
```

## usecase.6 = resource enumeration

```
given(user wants to see resources)
  when(user runs `khlone list sites`)
    then(output shows all sites on machine)
    then(output shows zone counts and activity)

  when(user runs `khlone list zones`)
    then(output shows all zones in current site)
    then(output shows clone status per zone)

  when(user runs `khlone list crews`)
    then(output shows all clones in current zone)
    then(output shows role, brain, status, queue depth)

  when(user runs `khlone list tasks`)
    then(output shows all tasks in current zone)
    then(output shows status, clone assignment, tokens)
```

## usecase.7 = clone target

```
given(user wants specific clone)
  when(user runs `khlone act "task" --who mechanic.1`)
    then(task is queued to mechanic.1)
    then(hero clone is bypassed)

  when(user runs `khlone act "research" --who researcher++`)
    then(new researcher clone is enrolled)
    then(task is queued to new clone)
    then(output shows enroll confirmation)

given(role alias not defined in khlone.yml)
  when(user runs `khlone act "task" --who unknown++`)
    then(error indicates unknown role)
    then(error lists available roles)
      sothat(typos are caught)
```

## usecase.8 = skill dispatch

```
given(hero clone knows skill review.architecture)
  when(user runs `khlone ask --skill review.architecture`)
    then(task is queued to hero clone)
    then(skill is invoked)

given(only researcher clone knows skill research.patterns)
  when(user runs `khlone ask --skill research.patterns`)
    then(researcher clone is enrolled)
    then(task is queued to researcher)
    then(output shows enroll and skill invocation)

given(multiple clones know skill code.review)
  when(user runs `khlone ask --skill code.review`)
    then(error indicates ambiguity)
    then(error lists clones that know the skill)
    then(error suggests --who to disambiguate)

given(no clone knows skill unknown.skill)
  when(user runs `khlone ask --skill unknown.skill`)
    then(error indicates skill not found)
    then(error lists available skills)
```

## usecase.9 = brain selection

```
given(hero brain is claude per khlone.yml)
  when(user runs `khlone act "task"`)
    then(task uses claude brain)

  when(user runs `khlone act "task" --brain grok`)
    then(task uses grok brain)
    then(hero brain is not affected for future tasks)

given(brain alias not defined in khlone.yml)
  when(user runs `khlone act "task" --brain unknown`)
    then(error indicates unknown brain)
    then(error lists available brains)
```

## usecase.10 = cross-zone dispatch

```
given(user in @main zone)
  when(user runs `khlone status --zone @feat/auth`)
    then(output shows status of @feat/auth zone)

  when(user runs `khlone act "fix bug" --zone @feat/auth`)
    then(task is queued in @feat/auth zone)
    then(user stays in current directory)

  when(user runs `khlone list tasks --zone @feat/auth`)
    then(output shows tasks from @feat/auth)

given(zone does not exist)
  when(user runs `khlone act "task" --zone @nonexistent`)
    then(zone is created)
    then(hero clone is enrolled in new zone)
    then(task is queued)
```

## usecase.11 = cross-site dispatch

```
given(user in site ehmpathy/myrepo)
  when(user runs `khlone status --site ahbode/svc-jobs`)
    then(output shows status of ahbode/svc-jobs)

  when(user runs `khlone act "task" --zone svc-jobs@feat/invoice`)
    then(task is queued in svc-jobs site, feat/invoice zone)
    then(user stays in current directory)

  when(user runs `khlone ask "question" --zone ahbode/svc-auth@main --await`)
    then(task runs in svc-auth site)
    then(output returns to current shell)

given(site not in orchestrator registry)
  when(user runs `khlone status --site unknown/repo`)
    then(error indicates site not found)
    then(error suggests how to register site)
```

## usecase.12 = crash recovery

```
given(clone crashes mid-task)
  when(khlone detects crash)
    then(clone is auto-restarted)
    then(task resumes from checkpoint)
    then(user is not interrupted)
      sothat(work survives failures)

given(user exits shell with tasks queued)
  when(user opens new shell)
    then(queue is preserved)
    then(clone continues work)
    then(`khlone status` shows progress)
```

## usecase.13 = task artifacts

```
given(task completes)
  when(onStop hooks run)
    then(summary artifact is captured)
    then(complete artifact is captured)
    then(token count is recorded)

  when(user runs `khlone status --task task-abc-123`)
    then(output shows all artifacts)
    then(output shows token usage)
```

## usecase.14 = transcript access

```
given(clone has run tasks)
  when(user runs `khlone log`)
    then(output shows transcript)

  when(user runs `khlone log --who mechanic.1`)
    then(output shows transcript for mechanic.1)
```

---

## error experiences

```
given(not in a git repo and no --site flag)
  when(user runs `khlone act "task"`)
    then(error indicates not in a git repo)
    then(error suggests --site flag)

given(khlone.yml not found)
  when(user runs `khlone act "task"`)
    then(error indicates absent config)
    then(error suggests how to create khlone.yml)

given(invalid flag combination)
  when(user runs `khlone act "task" --watch --talk`)
    then(error indicates mutually exclusive flags)

given(invalid zone address format)
  when(user runs `khlone act "task" --zone "bad format"`)
    then(error indicates invalid format)
    then(error shows valid formats)
```
