# git graft â€” blackbox criteria

## usecase.1 = plan mode (default)

```
given('a branch with commits to graft')
  when('git graft --onto <target> --from <commit>')
    then('shows branch name')
    then('shows onto target')
    then('shows from commit')
    then('shows till commit (HEAD by default)')
    then('shows commit count')
    then('lists each commit with hash and message')
    then('shows hint to use --mode apply')
    then('makes no changes to branch')
      sothat('user can preview before execution')
```

## usecase.2 = apply mode

```
given('a branch with commits to graft')
  when('git graft --onto <target> --from <commit> --mode apply')
    then('resets branch to onto target')
    then('cherry-picks each commit in order')
    then('shows success message with commit count')
    then('branch HEAD is now based on onto target')
      sothat('commits are replayed onto new base')
```

## usecase.3 = single commit

```
given('a branch with commits to graft')
  when('git graft --onto <target> --from <commit> --till <same-commit>')
    then('shows 1 commit in plan')
    then('replays only that one commit on apply')
      sothat('user can graft just one commit')
```

## usecase.4 = range of commits

```
given('a branch with commits B1, B2, B3')
  when('git graft --onto main --from B1 --till B2')
    then('shows 2 commits: B1, B2')
    then('does not include B3')
      sothat('user can graft a subset of commits')
```

## usecase.5 = conflict on apply

```
given('a branch with commits that conflict with target')
  when('git graft --onto <target> --from <commit> --mode apply')
  and('cherry-pick encounters conflict')
    then('saves original HEAD to .git/GRAFT_ORIG_HEAD')
    then('shows conflict error')
    then('shows instruction: git graft --continue')
    then('shows instruction: git graft --abort')
      sothat('user knows how to recover')

  when('git graft --continue')
  and('conflicts are resolved')
    then('completes cherry-pick')
    then('removes .git/GRAFT_ORIG_HEAD')
    then('shows success message')

  when('git graft --abort')
    then('aborts cherry-pick')
    then('resets to original HEAD from .git/GRAFT_ORIG_HEAD')
    then('removes .git/GRAFT_ORIG_HEAD')
    then('shows abort message')
```

## usecase.5b = ancestry filter

```
given('a branch with commits, some already in target')
  when('git graft --onto <target> --from <commit>')
    then('excludes commits reachable from target')
    then('shows only commits not in target')
      sothat('no duplicate commits are grafted')
```

## usecase.6 = invalid inputs

```
given('any state')
  when('git graft without --onto')
    then('shows error: --onto is required')

  when('git graft --onto main without --from')
    then('shows error: --from is required')

  when('git graft --onto main --from <nonexistent>')
    then('shows error: no commits found in range')

  when('git graft --mode invalid')
    then('shows error: --mode must be plan or apply')

  when('git graft in detached HEAD state')
    then('shows error: not on a branch')
```

## usecase.7 = help

```
given('any state')
  when('git graft --help')
    then('shows usage')
    then('shows options with descriptions')
    then('shows range syntax explanation')
    then('shows examples')
```
