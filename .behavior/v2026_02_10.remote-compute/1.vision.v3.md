# vision: remote-compute v3 (khlone)

> khlone = clone zone orchestrator

## what is khlone?

**khlone** orchestrates **zones**, each with **crews of clones**.

| term | definition |
|------|------------|
| **clone** | brain + role, configured via rhachet (e.g., claude as mechanic.1) |
| **crew** | set of clones on a zone (foreman.1, mechanic.1, architect.1, ...) |
| **zone** | remote machine + worktree + crew of clones |
| **khlone** | orchestrates zones and their crews |

```
you â”€â”€â–º khlone â”€â”€â–º zone â”€â”€â–º crew of clones
                      â”‚
                      â”œâ”€â”€ foreman.1 (coordinates)
                      â”œâ”€â”€ mechanic.1
                      â”œâ”€â”€ mechanic.2
                      â””â”€â”€ architect.1
```

khlone:

- **orchestrates crews** â€” spin up multiple brains (claude code, codex, etc) with different roles
- **manages zones** â€” one cloud machine per worktree, shared by the crew
- **enables drop-in** â€” attach to any clone's session by role name
- **filters output** â€” eliminates fluff, keeps your terminal low-resource and stable
- **retains transcripts** â€” stores every clone's stream for review, archive, and reflection
- **syncs files** â€” git patches between local and remote, conflict resolution

you paid for those tokens. khlone makes sure you can always review what you bought.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    khlone: clone zone orchestrator                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   ZONE: ~/code/myproject-auth (ec2: m6i.4xlarge)            â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ CREW                                                     â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚ role          brain       status         task            â”‚   â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚   â”‚ foreman.1     claude      active         coordinate crew â”‚   â”‚
â”‚   â”‚ architect.1   claude      active (89%)   design auth api â”‚   â”‚
â”‚   â”‚ mechanic.1    claude      active (73%)   implement jwt   â”‚   â”‚
â”‚   â”‚ mechanic.2    claude      active (45%)   implement rbac  â”‚   â”‚
â”‚   â”‚ mechanic.3    codex       active (31%)   implement audit â”‚   â”‚
â”‚   â”‚ ergonomist.1  claude      idle           pending review  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ ZONE STATUS                                          â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚ diffs:      +847 / -234 lines (14 files changed)        â”‚   â”‚
â”‚   â”‚ uptime:     2h 14m                                       â”‚   â”‚
â”‚   â”‚ compute:    $1.72 ($0.77/hr)                            â”‚   â”‚
â”‚   â”‚ tokens:     234,891 (~$3.52)                            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   YOU â”€â”€â–º khlone tui â”€â”€â–º attach to any clone's session          â”‚
â”‚              â”‚                                                   â”‚
â”‚              â”œâ”€â”€ crew: see all roles + status                   â”‚
â”‚              â”œâ”€â”€ zone: diffs, usage, cost                   â”‚
â”‚              â””â”€â”€ transcripts: archived per role                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### key concepts

| concept | description |
|---------|-------------|
| **brain** | ai provider (claude, codex) â€” raw reason capability |
| **role** | identity with skills + briefs (foreman, mechanic, architect) â€” defines capabilities |
| **clone** | brain + role via rhachet = actor ready to work (mechanic.1, foreman.1) |
| **crew** | the set of clones active on a zone; configured via `khlone.yml` |
| **clone.0** | the initial clone spawned on `khlone init`; configurable per zone |
| **zone** | remote machine + worktree + crew of clones |
| **zone-provision** | findsert zone via declastruct-aws: instance, supplies, worktree |
| **khlone.yml** | zone config; specifies instance, supplies, and crew |
| **attach** | drop into a specific clone's session |

### zone configuration

zones are configured via `khlone.yml`. this defines both the infrastructure (instance, supplies) and the crew (clone.0, defaults).

```yaml
# khlone.yml
instance:
  type: m6i.xlarge        # ec2 instance type
  region: us-east-1       # aws region
  ami: ami-0123456789     # base image (optional, defaults to khlone-base)

supplies:                  # tools to install on remote
  - node@22
  - pnpm@9
  - aws-cli
  - gh

repo:
  origin: git@github.com:myorg/myrepo.git   # for git clone
  deploy_key: ~/.ssh/deploy_myrepo          # ssh key for clone

# crew config â€” ehmpathy convention
crew:
  clone.0:
    role: foreman
    brain: claude

# crew config â€” solo dev convention
# crew:
#   clone.0:
#     role: mechanic
#     brain: claude
```

ehmpathy crews use `foreman.1` as clone.0 â€” a coordinator role that hires and manages the crew. solo devs might prefer `mechanic.1` as clone.0 â€” skip the coordinator, get direct work.

the examples below use the ehmpathy convention (foreman.1 as clone.0), but the same patterns apply to any crew configuration.

### zone provision

when you run `khlone zone set`, the provision sequence is:

```
khlone zone set
    â”‚
    â”œâ”€â”€ 1. read config (khlone.yml)
    â”‚       â””â”€â”€ instance, supplies, crew
    â”‚
    â”œâ”€â”€ 2. zone.provision (via declastruct-aws)
    â”‚       â”œâ”€â”€ provision instance (findsert ec2)
    â”‚       â”œâ”€â”€ provision supplies (node, pnpm, etc)
    â”‚       â””â”€â”€ provision worktree
    â”‚           â”œâ”€â”€ git clone (from origin)
    â”‚           â”œâ”€â”€ git checkout branch
    â”‚           â””â”€â”€ npm ci
    â”‚
    â”œâ”€â”€ 3. start daemon (khlone-daemon)
    â”‚
    â””â”€â”€ 4. spawn clone.0 (from khlone.yml)
            â””â”€â”€ READY
```

**fresh zone**: full provision (instance â†’ supplies â†’ worktree â†’ daemon â†’ clone.0)

**reconnect zone**: connect â†’ verify daemon â†’ sync queued patches â†’ resume

## the outcome world

### before

- laptop fans spin constantly
- terminal input lags words behind
- claude code sessions compete with browser, slack for cpu/ram
- "let me close some stuff" becomes a daily ritual
- you and robots fight over the same files in real-time
- connection drops kill your session

### after

- laptop runs khlone tui â€” instant keystrokes, zero compute
- each worktree has its own remote clone with dedicated resources
- robots work on their machine, you work on yours
- sync via git patches â€” no live fs mount, no teletype lag
- conflicts surface explicitly â€” you decide how to resolve
- connection drops? reconnect seamlessly, queue when offline
- 4 worktrees = 4 parallel machines, each with many robots, dynamically configurable resources

### the "aha" moment

you have one complex feature: `auth-system`. you run `khlone init` and dispatch "build a complete auth system with jwt, rbac, and audit trail" to the foreman. foreman.1 hires an architect and 3 mechanics. architect.1 designs the api. mechanic.1 implements jwt. mechanic.2 implements rbac. mechanic.3 implements audit. you check `khlone crew` â€” 5 brains active. 2 hours later, you pull results, resolve 3 conflicts where mechanics touched the same files. cost: $5.24 compute + $3.52 tokens. total hands-on time: 20 minutes.

---

## user experience

### usecase 1: single worktree workflow

**goal**: offload a feature to the foreman

**timeline**:
1. `git tree --from main --name feature-auth` (creates worktree + opens terminal)
2. `khlone zone set` (provisions zone, spawns foreman.1)
3. `khlone dispatch "implement user authentication with jwt"` (goes to foreman.1)
4. foreman.1 adds mechanics, architects as needed and coordinates
5. `khlone crew get` â€” see who foreman.1 brought on
6. `khlone pull` â€” receive changes as git patch
7. review diff, resolve conflicts if any
8. `git push` â€” ship it
9. `khlone zone del` â€” delete zone

**contract**:
```sh
# provision zone (spawns clone.0)
khlone zone set                   # findsert zone, report status
khlone zone set --ttl 4h          # auto-delete after 4 hours

# dispatch to clone.0 (foreman manages crew internally)
khlone dispatch "add rate limits to all api endpoints"

# check crew status (see who foreman brought on)
khlone crew get                   # current zone crew
khlone zone status --all          # all active zones

# sync changes
khlone sync            # push local changes to remote (git patch)
khlone pull            # pull remote changes to local (git patch)
khlone pull --force    # overwrite local with remote (discard local)

# attach to watch any role work (human can drop in on anyone)
khlone crew attach foreman.1           # stream foreman's coordination
khlone crew attach mechanic.1          # stream logs from mechanic.1
khlone crew attach mechanic.1 --shell  # interactive shell on remote

# teardown
khlone zone del            # delete zone
khlone zone del --all      # delete all zones
```

### usecase 2: multi-worktree parallel work

**goal**: run crews on different features simultaneously

**timeline**:
1. `git tree --from main --name auth && git tree --from main --name api && git tree --from main --name tests`
2. `khlone zone set` in each worktree (each gets its own foreman.1)
3. dispatch to each foreman â€” they manage their crews
4. crews work in parallel â€” separate instances, no contention
5. pull results from each as they complete
6. merge branches via normal git workflow

**contract**:
```sh
# provision zones for multiple worktrees (each gets clone.0)
cd ~/code/myproject-auth && khlone zone set
cd ~/code/myproject-api && khlone zone set
cd ~/code/myproject-tests && khlone zone set

# dispatch to each (they handle crew internally)
khlone dispatch "implement oauth" --zone ~/code/myproject-auth
khlone dispatch "add pagination" --zone ~/code/myproject-api
khlone dispatch "increase coverage" --zone ~/code/myproject-tests

# status across all zones
khlone zone status --all

# pull from all zones
khlone pull --all
```

### usecase 3: conflict resolution

**goal**: handle divergent changes between you and robot

**timeline**:
1. you edit `src/auth.ts` locally
2. robot edits `src/auth.ts` remotely (different lines)
3. `khlone pull` â€” patches merge cleanly
4. robot edits `src/auth.ts` remotely (same lines as you)
5. `khlone pull` â€” conflict detected
6. khlone shows conflict markers, you resolve
7. `khlone sync` â€” push resolved version to remote

**contract**:
```sh
# pull with conflict
$ khlone pull
âš ï¸  conflict in src/auth.ts
    local:  lines 42-47 (your edit)
    remote: lines 42-51 (robot edit)

# view conflict
$ khlone diff src/auth.ts

# resolve options
$ khlone resolve src/auth.ts --keep local   # discard robot's change
$ khlone resolve src/auth.ts --keep remote  # discard your change
$ khlone resolve src/auth.ts --merge        # open in editor with markers

# after manual resolution
$ khlone sync   # push resolved version
```

### usecase 4: transcript review

**goal**: review, search, and reflect on past sessions by role

**timeline**:
1. mechanic.1 completes a task
2. `khlone log --role mechanic.1` â€” view mechanic.1's transcript
3. search across all roles for specific decisions or errors
4. archive notable sessions for future reference
5. calculate token spend per role and per zone

**contract**:
```sh
# view transcript for specific role
$ khlone log --role mechanic.1

# list all sessions with role breakdown
$ khlone log --list
session    worktree           role          started    tokens    cost
abc123     myproject-auth     foreman.1     2h ago      8,234    $0.12
abc123     myproject-auth     mechanic.1    2h ago     45,231    $0.68
abc123     myproject-auth     mechanic.2    2h ago     38,109    $0.57
def456     myproject-api      foreman.1     1d ago     12,445    $0.19
def456     myproject-api      architect.1   1d ago     98,721    $1.48
...

# search across all roles
$ khlone log --search "why did you choose jwt"
mechanic.1 (abc123): "i chose jwt because..."
architect.1 (def456): "jwt was selected for..."

# export specific role's transcript
$ khlone log --role mechanic.1 --export ~/reviews/jwt-implementation.md

# show token/cost by role for current zone
$ khlone log --cost
role            input       output      total       cost
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
foreman.1        2,445       5,789       8,234      $0.12
mechanic.1      12,445      32,786      45,231      $0.68
mechanic.2      10,891      27,218      38,109      $0.57
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
zone total                          91,574      $1.37
```

### usecase 5: crew management (human override)

**goal**: manually manage crew when you want direct control

typically, you dispatch to clone.0 and let it manage the crew. but sometimes you want direct control â€” add specific roles, dispatch to specific brains, or override clone.0's decisions.

**timeline**:
1. `khlone zone set` â€” provision zone (spawns foreman.1)
2. `khlone crew add --role mechanic --brain claude` â€” manually add mechanic.1
3. `khlone crew add --role mechanic --brain claude` â€” manually add mechanic.2
4. `khlone crew add --role mechanic --brain codex` â€” manually add mechanic.3
5. `khlone crew add --role architect --brain claude` â€” manually add architect.1
6. `khlone dispatch "design the auth api" --to architect.1` â€” direct dispatch
7. `khlone dispatch "implement jwt validation" --to mechanic.1`
8. `khlone dispatch "implement rbac middleware" --to mechanic.2`
9. `khlone dispatch "implement audit trail" --to mechanic.3`
10. `khlone crew get` â€” view all roles + status + progress
11. `khlone crew attach mechanic.1` â€” drop into mechanic.1's session
12. `khlone zone get` â€” view diffs, compute usage, token costs

**contract**:
```sh
# view crew status
$ khlone crew get
role          brain       status         task
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
foreman.1     claude      active         coordinate crew
architect.1   claude      active (89%)   design auth api
mechanic.1    claude      active (73%)   implement jwt
mechanic.2    claude      active (45%)   implement rbac
mechanic.3    codex       active (31%)   implement audit
ergonomist.1  claude      idle           awaited review

# add roles to crew
khlone crew add --role mechanic --brain claude     # â†’ mechanic.1
khlone crew add --role mechanic --brain claude     # â†’ mechanic.2
khlone crew add --role reviewer --brain claude     # â†’ reviewer.1
khlone crew add --role tester --brain codex        # â†’ tester.1

# remove roles
khlone crew del mechanic.2
khlone crew del --role mechanic --all              # remove all mechanics

# dispatch to specific roles
khlone dispatch "implement jwt" --to mechanic.1
khlone dispatch "review the jwt implementation" --to reviewer.1

# attach to a specific role's session
khlone crew attach mechanic.1       # drop into mechanic.1's clone
khlone crew attach architect.1      # drop into architect.1's clone
khlone crew detach                  # return to filtered crew view

# view zone summary
$ khlone zone get
ZONE: ~/code/myproject-auth (ec2: m6i.4xlarge)

diffs:      +847 / -234 lines (14 files changed)
uptime:     2h 14m
compute:    $1.72 ($0.77/hr)

TOKENS BY ROLE:
  foreman.1:    12,445   ($0.19)
  architect.1:  45,231   ($0.68)
  mechanic.1:   78,432   ($1.18)
  mechanic.2:   52,109   ($0.78)
  mechanic.3:   31,890   ($0.48)
  ergonomist.1: 14,784   ($0.22)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  total:        234,891  ($3.52)
```

### usecase 6: offline + reconnect

**goal**: keep work active when connection drops

**timeline**:
1. connection drops mid-task
2. robot continues on remote (unaware of disconnect)
3. you continue local edits (queued for sync)
4. connection restored
5. `khlone reconnect` â€” resumes stream, syncs queued changes
6. pull robot's progress, resolve any conflicts

**contract**:
```sh
# connection drops
$ khlone status
âš ï¸  disconnected from khlone-abc123
    robot status: unknown (last seen 5m ago)
    queued local changes: 3 files

# reconnect
$ khlone reconnect
âœ“ connected to khlone-abc123
âœ“ robot status: active (task 73% complete)
âœ“ synced 3 queued files
âš ï¸  conflict in src/api.ts â€” run `khlone pull` to resolve
```

### usecase 7: behavior-driven development (getWeatherEmojified)

**goal**: build a feature from a `.behavior` thought route â€” wish â†’ vision â†’ criteria â†’ execution

this example shows how khlone integrates with behavior-driven development. you define what you want in `.behavior/`, then dispatch to the foreman who reads the behavior, hires the right crew, and coordinates execution through the phases.

**the behavior**:

```
.behavior/v2026_02_11.weather-emojified/
â”œâ”€â”€ 0.wish.md                    # what you want (plain language)
â”œâ”€â”€ 1.vision.md                  # how it should work (design)
â”œâ”€â”€ 2.criteria.blackbox.md       # acceptance criteria (testable)
â”œâ”€â”€ 3.research.md                # domain research (apis, patterns)
â””â”€â”€ 4.execution.md               # implementation log (auto-generated)
```

**0.wish.md**:
```md
# wish: weather emojified

i want an endpoint that returns the current weather as emojis

e.g., GET /weather/emojified?city=austin â†’ â˜€ï¸ğŸŒ¡ï¸85Â°F

should work for any city. should be fun and delightful.
```

**1.vision.md**:
```md
# vision: getWeatherEmojified

## what
- endpoint: GET /api/weather/emojified
- input: city name (query param)
- output: emoji string that represents current conditions

## how
- fetch weather data from openweathermap api
- map conditions to emojis:
  - clear â†’ â˜€ï¸
  - clouds â†’ â˜ï¸
  - rain â†’ ğŸŒ§ï¸
  - snow â†’ â„ï¸
  - thunderstorm â†’ â›ˆï¸
- include temperature emoji: ğŸ¥¶ (<32Â°F), ğŸŒ¡ï¸ (32-85Â°F), ğŸ¥µ (>85Â°F)
- format: {condition_emoji}{temp_emoji}{temp}Â°F

## example
austin, clear, 85Â°F â†’ "â˜€ï¸ğŸŒ¡ï¸85Â°F"
denver, snow, 28Â°F â†’ "â„ï¸ğŸ¥¶28Â°F"
```

**2.criteria.blackbox.md**:
```md
# criteria: getWeatherEmojified

## acceptance tests

given: valid city "austin"
when: GET /api/weather/emojified?city=austin
then: response contains weather emoji and temperature

given: invalid city "notarealplace12345"
when: GET /api/weather/emojified?city=notarealplace12345
then: 404 with error message

given: city param absent
when: GET /api/weather/emojified
then: 400 with "city required" message
```

**timeline**:

```sh
# 1. you write the behavior (wish, vision, criteria)
vim .behavior/v2026_02_11.weather-emojified/0.wish.md
vim .behavior/v2026_02_11.weather-emojified/1.vision.md
vim .behavior/v2026_02_11.weather-emojified/2.criteria.blackbox.md

# 2. create worktree and init zone
git worktree add ../myapi-weather-emojified -b feat/weather-emojified
cd ../myapi-weather-emojified
khlone init

# 3. dispatch the behavior to foreman
khlone dispatch "execute .behavior/v2026_02_11.weather-emojified"

# 4. foreman reads behavior, hires crew, coordinates
#    (you can watch via khlone attach foreman.1)
```

**what foreman does**:

```
foreman.1 reads behavior:
    â”œâ”€â”€ 0.wish.md     â†’ understands the goal
    â”œâ”€â”€ 1.vision.md   â†’ understands the design
    â””â”€â”€ 2.criteria.md â†’ understands success criteria

foreman.1 hires crew:
    â”œâ”€â”€ architect.1   â†’ design api contract, error handler
    â”œâ”€â”€ mechanic.1    â†’ implement endpoint + weather service
    â”œâ”€â”€ mechanic.2    â†’ implement emoji mapper
    â””â”€â”€ tester.1      â†’ write acceptance tests from criteria

foreman.1 coordinates:
    1. architect.1 designs â†’ produces api spec
    2. mechanic.1 + mechanic.2 implement in parallel
    3. tester.1 writes tests from criteria
    4. foreman.1 runs tests, iterates until green
    5. foreman.1 writes 4.execution.md (log of what was done)
```

**watch the crew work**:

```sh
$ khlone crew
role          brain       status         task
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
foreman.1     claude      active         coordinate weather-emojified
architect.1   claude      complete       api contract designed
mechanic.1    claude      active (67%)   implement endpoint
mechanic.2    claude      active (82%)   implement emoji mapper
tester.1      claude      active (45%)   write acceptance tests

$ khlone attach mechanic.1
# drops into mechanic.1's raw stream...
# ctrl+d to detach
```

**pull results**:

```sh
$ khlone pull
âœ“ pulled 7 files from remote

$ git status
new file: src/contract/endpoints/getWeatherEmojified.ts
new file: src/domain.operations/weather/getWeatherForCity.ts
new file: src/domain.operations/weather/mapWeatherToEmoji.ts
new file: src/access/sdks/openweathermap/getWeather.ts
new file: src/contract/endpoints/getWeatherEmojified.acceptance.test.ts
modified: .behavior/v2026_02_11.weather-emojified/4.execution.md

$ npm run test:acceptance -- getWeatherEmojified
âœ“ valid city returns emoji weather (234ms)
âœ“ invalid city returns 404 (89ms)
âœ“ city absent returns 400 (12ms)

3 passed
```

**4.execution.md** (auto-generated by foreman):

```md
# execution: getWeatherEmojified

## crew
- foreman.1: coordination
- architect.1: api design
- mechanic.1: endpoint implementation
- mechanic.2: emoji mapper
- tester.1: acceptance tests

## timeline
- 14:23 - foreman.1 read behavior, hired crew
- 14:25 - architect.1 produced api contract
- 14:31 - mechanic.1 completed endpoint
- 14:33 - mechanic.2 completed emoji mapper
- 14:38 - tester.1 completed acceptance tests
- 14:39 - foreman.1 ran tests, all green
- 14:40 - foreman.1 marked complete

## artifacts
- src/contract/endpoints/getWeatherEmojified.ts
- src/domain.operations/weather/getWeatherForCity.ts
- src/domain.operations/weather/mapWeatherToEmoji.ts
- src/access/sdks/openweathermap/getWeather.ts
- src/contract/endpoints/getWeatherEmojified.acceptance.test.ts

## tokens
- foreman.1:   4,231   ($0.06)
- architect.1: 8,445   ($0.13)
- mechanic.1:  23,109  ($0.35)
- mechanic.2:  12,876  ($0.19)
- tester.1:    15,443  ($0.23)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
total:         64,104  ($0.96)

## duration
17 minutes
```

**ship it**:

```sh
$ git add .
$ git commit -m "feat: add getWeatherEmojified endpoint"
$ git push origin feat/weather-emojified
$ gh pr create --title "feat: weather emojified endpoint" --body "from .behavior/v2026_02_11.weather-emojified"

$ khlone halt   # pause zone (or khlone drop to delete)
```

**key insight**: the `.behavior` folder is the contract between you and the crew. you define the wish, vision, and criteria. the foreman reads it, hires the right roles, and coordinates execution. the execution log documents what happened. you pull results, review, ship.

---

## architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    khlone: clone zone orchestrator                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   LOCAL (your laptop)              REMOTE (ec2 per zone)    â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ khlone tui        â”‚            â”‚ khlone-daemon         â”‚    â”‚
â”‚   â”‚                   â”‚â—„â”€websocketâ”€â–ºâ”‚                       â”‚    â”‚
â”‚   â”‚ â€¢ crew management â”‚            â”‚ â€¢ spawns clones       â”‚    â”‚
â”‚   â”‚ â€¢ attach by role  â”‚            â”‚ â€¢ routes by role      â”‚    â”‚
â”‚   â”‚ â€¢ zone view   â”‚            â”‚ â€¢ streams per role    â”‚    â”‚
â”‚   â”‚ â€¢ filter output   â”‚            â”‚ â€¢ patch sync          â”‚    â”‚
â”‚   â”‚ â€¢ queue offline   â”‚            â”‚ â€¢ resource monitor    â”‚    â”‚
â”‚   â”‚ â€¢ transcript view â”‚            â”‚                       â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â”‚                                  â”‚                  â”‚
â”‚            â”‚                                  â–¼                  â”‚
â”‚            â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚            â”‚                       â”‚ CREW (clones)         â”‚    â”‚
â”‚            â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚            â”‚                       â”‚ foreman.1   (claude)  â”‚    â”‚
â”‚            â”‚                       â”‚ architect.1 (claude)  â”‚    â”‚
â”‚            â”‚                       â”‚ mechanic.1  (claude)  â”‚    â”‚
â”‚            â”‚                       â”‚ mechanic.2  (claude)  â”‚    â”‚
â”‚            â”‚                       â”‚ mechanic.3  (codex)   â”‚    â”‚
â”‚            â”‚                       â”‚ ergonomist.1(claude)  â”‚    â”‚
â”‚            â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â”‚                                  â”‚                  â”‚
â”‚            â–¼                                  â–¼                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ local worktree    â”‚            â”‚ remote worktree       â”‚    â”‚
â”‚   â”‚ ~/code/myproject  â”‚â—„â”€git patchâ”€â–ºâ”‚ /work/myproject       â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â”‚                                                     â”‚
â”‚            â–¼                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚   â”‚ transcript archiveâ”‚  â† full stream per role stored locally  â”‚
â”‚   â”‚ ~/.khlone/logs/   â”‚  â† review, search, reflect on sessions  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   ORCHESTRATOR (local or cloud)                                 â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ â€¢ instance lifecycle (up/down)                        â”‚     â”‚
â”‚   â”‚ â€¢ zone registry (which instance has which work)   â”‚     â”‚
â”‚   â”‚ â€¢ secrets injection                                   â”‚     â”‚
â”‚   â”‚ â€¢ cost tracker (compute + tokens per role)            â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚   LOCAL MODE:  persists in ~/.khlone (single device)            â”‚
â”‚   CLOUD MODE:  api gateway + lambda (~$5/mo, cross-device)      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### orchestrator flow

```
YOU                    KHLONE TUI              REMOTE ZONE
 â”‚                         â”‚                         â”‚
 â”‚  "khlone crew"          â”‚                         â”‚
 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                         â”‚
 â”‚                         â”‚  query daemon           â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚                         â”‚                         â”‚
 â”‚  â—„â”€â”€ crew status â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚      (all roles)        â”‚                         â”‚
 â”‚                         â”‚                         â”‚
 â”‚  "dispatch to mechanic.1"                         â”‚
 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                         â”‚
 â”‚                         â”‚  route to role          â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ mechanic.1
 â”‚                         â”‚                         â”‚
 â”‚  â—„â”€â”€ filtered progress â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                         â”‚                         â”‚
 â”‚  "khlone attach mechanic.1"                       â”‚
 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                         â”‚
 â”‚                         â”‚                         â”‚
 â”‚  â—„â”€â”€ raw stream â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ mechanic.1
 â”‚      (full output)      â”‚                         â”‚
 â”‚                         â”‚                         â”‚
 â”‚  "khlone zone"      â”‚                         â”‚
 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                         â”‚
 â”‚                         â”‚  query daemon           â”‚
 â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚                         â”‚                         â”‚
 â”‚  â—„â”€â”€ diffs, usage, cost â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                         â”‚                         â”‚
```

### git patch sync flow

```
LOCAL                              REMOTE
  â”‚                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚ you edit src/auth.ts    â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚              â”‚                   â”‚
  â”‚              â–¼                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚ git diff > patch        â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚              â”‚                   â”‚
  â”‚              â”‚ khlone sync       â”‚
  â”‚              â–¼                   â”‚
  â”‚         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
  â”‚              â”‚                   â”‚
  â”‚              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              â”‚     â”‚ git apply patch         â”‚
  â”‚              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚              â”‚                   â”‚
  â”‚              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              â”‚     â”‚ robot continues work    â”‚
  â”‚              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚              â”‚                   â”‚
  â”‚              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              â”‚     â”‚ robot edits files       â”‚
  â”‚              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚              â”‚                   â”‚
  â”‚              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              â”‚     â”‚ git diff > patch        â”‚
  â”‚              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚              â”‚                   â”‚
  â”‚         â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
  â”‚              â”‚ khlone pull       â”‚
  â”‚              â–¼                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚ git apply patch         â”‚     â”‚
  â”‚  â”‚ (or conflict if overlap)â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                                  â”‚
```

---

## mental model

### how you'd describe khlone to a friend

> "khlone gives me a foreman in the cloud. i spin up a zone, tell the foreman what i need, and it hires the crew â€” mechanics, architects, reviewers. the foreman coordinates the work. i can check on who's on the crew, drop into any role's session, or override and manage the crew myself if i want. every token is tracked by role so i know where my money went."

### analogies

- **construction foreman** â€” you coordinate the crew, each role does their part
- **tmux for ai brains** â€” multiple sessions, attach/detach freely
- **git remotes, but for compute** â€” push tasks, pull results
- **dvr for ai sessions** â€” record everything, replay anytime

### terms

| user might say | khlone term |
|----------------|-------------|
| "start a zone" | `khlone init` (alias for `khlone zone set`) |
| "pause the zone" | `khlone halt` (alias for `khlone zone halt`) |
| "delete the zone" | `khlone drop` (alias for `khlone zone del`) |
| "do this task" | `khlone dispatch "..."` (goes to clone.0) |
| "show the crew" | `khlone crew` (alias for `khlone crew get`) |
| "give mechanic.1 a task" | `khlone dispatch --to mechanic.1` (override) |
| "add a mechanic myself" | `khlone crew add --role mechanic` (override) |
| "what's the status" | `khlone zone get` / `khlone crew get` |
| "drop into mechanic.1" | `khlone attach mechanic.1` (alias for `khlone crew attach`) |
| "back to overview" | `khlone crew detach` |
| "get all changes" | `khlone pull` |
| "send my changes" | `khlone sync` |
| "we both edited this" | conflict â†’ `khlone resolve` |
| "what did mechanic.1 do" | `khlone log --clone mechanic.1` |
| "how much per role" | `khlone zone get` / `khlone log --cost` |
| "remove mechanic.2" | `khlone crew del mechanic.2` (override) |
| "shut it all down" | `khlone drop --all` |

---

## evaluation

### how well does it solve the goals?

| goal | solved? |
|------|---------|
| laptop stops sluggish behavior | yes â€” compute fully offloaded |
| input latency eliminated | yes â€” tui is local, 0ms keystrokes |
| run many claude sessions | yes â€” one instance per worktree |
| file sync without lag | yes â€” git patches, not live mount |
| handle conflicts cleanly | yes â€” explicit resolution, no surprises |
| survive connection drops | yes â€” queue + reconnect |
| retain value from tokens spent | yes â€” full transcript archive |
| low-resource stable terminal | yes â€” filtered output, attach for full |

### pros

| benefit | details |
|---------|---------|
| zero keystroke latency | tui runs locally |
| parallel worktrees | each gets dedicated resources |
| clean sync model | git patches = proven, efficient |
| explicit conflicts | you decide, no auto-merge chaos |
| offline resilience | queue locally, sync when back |
| elastic scale | t3.small for typo, m6i.8xlarge for refactor |
| transcript archive | full brain stream stored, searchable, exportable |
| stable terminal | filtered output by default, low resource |
| cost visibility | per-session token + cost breakdown |

### cons / edgecases

| edgecase | mitigation |
|----------|------------|
| conflict resolution ux | clear diff view, simple commands |
| large binary files | git-lfs or exclude from sync |
| secrets on remote | inject via orchestrator, never in repo |
| instance cost creep | ttl auto-shutdown, cost alerts |
| worktree state drift | `khlone status` shows sync state |

### cost comparison

| approach | upfront | monthly (4hr/day) | latency |
|----------|---------|-------------------|---------|
| v1 homelab | $450 | ~$5 | ~1ms |
| v2 all-cloud | $0 | ~$53 | ~50ms dispatch |
| v3 khlone | $0 | ~$53 | 0ms keystrokes |

v3 has same cost as v2, but better ux via local tui + git patch sync.

### pit of success

- `--ttl` default prevents runaway instances
- `khlone status --all` shows all active clones + spend
- conflicts block until resolved â€” no silent overwrites
- offline changes queue automatically â€” no lost work
- `khlone drop --all` emergency kill switch

---

## open questions

1. **patch granularity**: sync on every save? manual `khlone sync`? debounced auto-sync?
   - probably: manual by default, `--auto` flag for continuous

2. **conflict ux**: how to make resolution painless?
   - option a: show in terminal with vimdiff
   - option b: open in local editor with markers
   - option c: web ui for complex conflicts

3. **instance lifecycle**: when to auto-terminate?
   - option a: idle timeout (no activity for 30m)
   - option b: task completion (all roles complete)
   - option c: explicit ttl only

4. **crew file conflicts**: what if two roles edit the same file?
   - option a: roles work on separate files (foreman coordinates)
   - option b: second role waits for first to complete
   - option c: git-style merge on remote, surface conflicts to you

5. **secrets flow**: how do robots access github, npm, apis?
   - option a: orchestrator injects env vars at boot
   - option b: aws secrets manager + iam roles
   - option c: 1password cli on remote

6. **initial clone**: how does remote get the code?
   - option a: git clone from origin (needs deploy key) â† default
   - option b: khlone pushes full repo as initial patch (for repos not on github)
   - option c: s3 snapshot of worktree (for very large repos)

13. **instance provision**: how to manage ec2 lifecycle?
    - option a: declastruct-aws (findsert semantics, idempotent) â† selected
    - option b: terraform under the hood (declarative, drift detection)
    - option c: aws sdk direct (simpler, less overhead)

14. **supplies cache**: how to avoid re-install of node/pnpm every time?
    - option a: bake into ami (khlone-base image with common tools)
    - option b: cache on ebs volume (persist across instance stops)
    - option c: nix flakes (reproducible, cached)

15. **branch creation**: what if local branch dne on remote?
    - option a: auto-create on remote at init time
    - option b: require branch exists on origin
    - option c: push local branch to origin first, then clone

7. **transcript storage**: where and how to store transcripts?
   - option a: local files (~/.khlone/logs/) â€” simple, searchable, exportable
   - option b: sqlite db â€” better search, structured queries
   - option c: cloud sync â€” access from any device, backup

8. **output filter**: how aggressive to filter the stream?
   - option a: show only task start/complete + errors
   - option b: show progress indicators + summaries
   - option c: configurable verbosity levels

9. **role auto-assignment**: how to decide which brain for which role?
   - option a: explicit always (`--brain claude`)
   - option b: defaults per role type in config
   - option c: foreman decides based on task complexity

10. **crew scaling**: limits on crew size?
    - option a: instance type determines max roles (ram/cpu bound)
    - option b: hard limit per zone (e.g., 8 roles max)
    - option c: unlimited, but cost warnings at thresholds

11. **orchestrator mode**: when to use local vs cloud?
    - local (~/.khlone): single device, no infra cost, simpler setup
    - cloud (api gateway): cross-device access, persistent from anywhere

---

## khlone command reference

```sh
# zone management
khlone zone set [--ttl DURATION]     # findsert zone for current tree, report status
khlone zone halt                     # pause zone (stop instance, preserve state)
khlone zone del [--force]            # delete zone (with safety checks)
khlone zone get                      # view diffs, usage, cost by role
khlone zone status [--all]           # status of current (or all) zones

# workcrew management
khlone crew get                      # list all clones + status
khlone crew add --role ROLE --brain BRAIN   # add clone â†’ clone.N
khlone crew del CLONE.N              # remove specific clone
khlone crew del --role ROLE --all    # remove all clones of role type
khlone crew attach CLONE.N           # drop into clone's session (raw stream)
khlone crew attach CLONE.N --shell   # interactive shell on remote
khlone crew detach                   # return to filtered crew view

# dispatch
khlone dispatch "TASK"                   # â†’ clone.0 (default)
khlone dispatch "TASK" --to CLONE.N      # â†’ specific clone (override)
khlone dispatch "TASK" --zone PATH   # â†’ clone.0 of specific zone

# sync
khlone sync [FILES...]           # local â†’ remote
khlone pull [--force] [--all]    # remote â†’ local

# conflicts
khlone diff [FILE]
khlone resolve FILE --keep (local|remote) | --merge

# transcripts (you paid for those tokens)
khlone log                       # current session transcript
khlone log --clone CLONE.N       # transcript for specific clone
khlone log --list                # all sessions with cost summary
khlone log --session ID          # specific session transcript
khlone log --search "QUERY"      # search across transcripts
khlone log --export PATH         # export to markdown
khlone log --cost                # token + cost breakdown by role

# connection
khlone reconnect

# config
khlone config set orchestrator local          # ~/.khlone (default)
khlone config set orchestrator cloud          # api gateway + lambda
khlone config set default-instance m6i.xlarge
khlone config set default-ttl 2h
khlone config set auto-sync true
khlone config set default-brain claude

# aliases (convenience)
khlone init                      # alias for: khlone zone set
khlone halt                      # alias for: khlone zone halt (pause instance)
khlone drop                      # alias for: khlone zone del
khlone crew                      # alias for: khlone crew get
khlone attach CLONE.N            # alias for: khlone crew attach CLONE.N
```

---

## next steps

1. prototype khlone tui (crew view, dispatch, attach/detach)
2. prototype khlone-daemon (multi-role clone spawner)
3. implement crew management (add/remove roles, role.N numbering)
4. implement git patch sync between local and remote
5. implement conflict detection + resolution ux
6. build orchestrator (instance lifecycle, zone â†’ instance map)
7. add reconnect + offline queue
8. implement transcript archive (per-role, searchable, cost breakdowns)
9. add zone dashboard (diffs, compute usage, token costs by role)
